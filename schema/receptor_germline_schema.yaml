#
# Schema definitions for IARC inferred gene submissions
#
# Submission Details
Submission:
    discriminator: AIR3
    description: Overall details of the submission
    type: object
    occurrence: single
    version: 1.4
    properties:
        submission_id:
            type: string
            description: Unique ID assigned by IARC on recipt of submission
            completed_by: IARC
        submission_date:
            type: date
            description: Date submission received
            completed_by: IARC
        submission_status:
            type: [draft,reviewing,published,complete]
            description: Status of submission
            completed_by: IARC
        submitter_name:
            type: string
            description: Full contact information of the submitter, i.e. the person depositing the data
            completed_by: submitter
        submitter_address:
            type: string
            description: Institutional address of submitter
            completed_by: submitter
        submitter_email:
            type: email_address
            description: Preferred email address of submitter
            completed_by: submitter
        submitter_phone:
            type: phone_number
            description: Preferred phone number of submitter
            completed_by: submitter
        species:
            type: species for which the gene is inferred
            description: Binomial designation of subject's species
            completed_by: submitter
        population_ethnicity:
            type: string
            description: Information on the ethnicity/population/race of the sample from which the submitted allele was inferred (if not known, use "UN")
            completed_by: submitter
        IARC_tracking:
            type: list of timestamped strings
            description: Notes from IARC tracking overall progress of this submission, eg additional info requested, when reviewed, etc
            completed_by: IARC


# Repertoire Dataset
Repertoire:
    discriminator: AIRR
    description: Details of the repertoire dataset from which inferences were made
    type: object
    occurrence: single
    properties:
        pub_ids:
            type: list of PubMed ids
            description: PubMed ids of peer-reviewed publications describing this dataset
            completed_by: submitter
        repository_name:
            type: string
            description: Name of the repository holding the sequence dataset (e.g. NIH SRA)
            completed_by: submitter
        repository_id:
            type: string
            description: Id or serial number of the sequence dataset within the repository
            completed_by: submitter
        dataset_url:
            type: url
            description: URL of the sequence dataset (in the case of the NIH SRA, please provide the URL to the Project)
            completed_by: submitter
        dataset_doi:
            type: doi
            description: doi of the sequence dataset (If any. Not all archives provide a doi, in particular the NIH SRA does not)
            completed_by: submitter
        miarr_compliant:
            type: [Yes, No]
            description: TRUE if the repertoire dataset and associated metadata is available in MiAIRR format
            completed_by: submitter
        miairr_link:
            type: url
            description: Link to MiAIRR metadata, if available
            completed_by: submitter
        sequencing_platform:
            type: string
            description: Designation of sequencing instrument used
            completed_by: submitter
        read_length:
            type: string
            description: Read length in bases for each direction
            completed_by: submitter
        forward_primer_set:
            type: list of IUPAC nucleotide notation
            description: sequences of forward pcr primers used for sequence amplification
            completed_by: submitter
        reverse_primer_set:
            type: list of IUPAC nucleotide notation
            description: sequences of reverse pcr primers used for sequence amplification
            completed_by: submitter
        primers_overlapping:
            type: [Yes, No]
            description: Please confirm that primers do not overlap with the stated sequence of any inferred allele.
            completed_by: submitter
        notes:
            type: text
            description: Notes relating to the dataset, for example covering details of origin or processing methods not described in publications or sequence depositions. Please provide details of cell types sequenced, or indicate clearly where this and related biosample information can be found.
            completed_by: submitter

# PubMed Ids
PubId:
    discriminator: AIRR
    description: PubMed Id and publication details
    type: object
    occurrence: single
    properties:
        pubmed_id:
            type: string
            description: PubMed ID
            tableview: true
        pub_title:
            type: string
            description: Publication Title
            tableview: true
            hide: true
        pub_authors:
            type: string
            description: Author list
            tableview: true
            hide: true
        repertoire_id:
            type: integer
            foreign_key: repertoire.id
            relationship: [repertoire, Repertoire, pub_ids]
            hide: true

# Primers
ForwardPrimer:
    discriminator: AIRR
    description: Forward Primer Set
    type: object
    occurrence: single
    properties:
        fw_primer_name:
            type: string
            description: Primer name or quick description
            tableview: true
        fw_primer_seq:
            type: ambiguous nucleotide sequence
            description: primer sequence
            tableview: true
        repertoire_id:
            type: integer
            foreign_key: repertoire.id
            relationship: [repertoire, Repertoire, forward_primer_set]
            hide: true

ReversePrimer:
    discriminator: AIRR
    description: Reverse Primer Set
    type: object
    occurrence: single
    properties:
        rv_primer_name:
            type: string
            description: Primer name or quick description
            tableview: true
        rv_primer_seq:
            type: ambiguous nucleotide sequence
            description: primer sequence
            tableview: true
        repertoire_id:
            type: integer
            foreign_key: repertoire.id
            relationship: [repertoire, Repertoire, reverse_primer_set]
            hide: true

Acknowledgements:
    discriminator: AIRR
    description: List of individuals whose contribution to this work should be acknowledged
    type: object
    occurrence: multiple
    properties:
        ack_name:
            type: string
            description: Full name of individual
            tableview: true
        ack_institution_name:
            type: string
            description: Individual's department and institution name
            tableview: true
        ack_ORCID_id:
            type: ORCID ID
            description: Individual's ORCID Id, if available
            tableview: true
        submission_id:
            type: integer
            hide: true
            foreign_key: submission.id
            relationship: [submission, Submission, acknowledgements]


# Inference Tool
InferenceTool:
    discriminator: AIRR
    description: Tool used to infer the submitted sequences
    type: object
    occurrence: single
    properties:
        tool_settings_name:
            type: string
            description: Descriptive name for this combination of tool and settings
            completed_by: submitter
            tableview: true
        tool_name:
            type: string
            description: Name of the inference tool
            completed_by: submitter
            tableview: true
        tool_version:
            type: string
            description: Version of the inference tool
            completed_by: submitter
        tool_starting_database:
            type: text
            description: Starting germline database used by the tool (please specify where and when it was obtained, name, and version id, if any)
            completed_by: submitter
            rows: 10
        tool_settings:
            type: text
            description: Settings/configuration of the tool when used to provide the inferences (automatically generated)
            completed_by: submitter
            rows: 20

            
# Inferred Sequence
Inferred_Sequence:
    discriminator: AIRR
    description: Details of inferred sequences submitted for IARC approval
    type: object
    occurrence: multiple
    subject_id: 
        type: string
        description: Identifier of the subject from which these sequences were inferred
        completed_by: submitter
    genotyope_id: 
        type: string
        description: Identifier of the genotype from which these sequences were inferred
        completed_by: submitter
    properties:
        sequence_id:
            type: string
            description: Identifier of the allele, issued by the submitter (need not follow any particular format)
            completed_by: submitter
        sequences:
            type: integer
            description: Overall number of sequences assigned to this allele
            completed_by: submitter
        domain:
            type: [V,D,J,C]
            description: Sequence domain (V, D, J or Constant)
        closest_reference:
            type: string
            description: The closest reference gene and allele, as inferred by the tool
            completed_by: submitter
        closest_host:
            type: string
            description: The closest reference gene and allele that is in the subject's inferred genotype, as inferred by the tool
            completed_by: submitter
        nt_diff:
            type: integer
            description: Number of nucleotides that differ between this sequence and the closest reference gene and allele
            completed_by: submitter
        nt_substitutions:
            type: string
            description: List of nucleotide substitutions (e.g. G112A) between this sequence and the closest reference gene and allele. 
            completed_by: submitter
        aa_diff:
            type: integer
            description: Number of amino acids that differ between this sequence and the closest reference gene and allele
            completed_by: submitter
        aa_substitutions:
            type: string
            description: List of amino acid substitutions (e.g. A96N) between this sequence and the closest reference gene and allele. Please use IMGT numbering for V-genes, and number from start of coding sequence for D- or J- genes.
            completed_by: submitter
        unmutated_frequency:
            type: number
            description: The proportion of unmutated sequences in the dataset represented by this sequence.
            completed_by: submitter
        unmutated_sequences:
            type: integer
            description: The number of records in the sequence dataset exactly matching this unmutated sequence
        unmutated_umis:
            type: integer
            description: The number of molecules (identified by Unique Molecular Identifiers) exactly matching this unmutated sequence (if UMIs were used)
            completed_by: submitter
        allelic_percentage:
            type: number
            description: The percentage at which this allele was observed in the sequence dataset, compared to other alleles
            completed_by: submitter
        unique_ds:
            type: integer
            description: Number of D allele calls (i.e., unique allelic sequences) found associated with an inferred V sequence
            completed_by: submitter
        unique_js:
            type: integer
            description: Number of J allele calls (i.e., unique allelic sequences) found associated with an inferred V sequence
            completed_by: submitter
        unique_cdr3s:
            type: integer
            description: Number of unique CDR3s found associated with the inferred V sequence
            completed_by: submitter
        haplotyping_locus:
            type: string
            description: Locus (or loci) from which haplotyping was inferred (e.g. IGHJ6)
            completed_by: submitter
        haplotyping_ratio:
            type: string
            description: Ratio (expressed as two percentages) with which the two inferred haplotypes were found (e.g. 60:40)
            completed_by: submitter
        nt_sequence:
            type: IUPAC nucleotide notation
            description: The consensus sequence provided by the inference tool
            completed_by: submitter
        phred_score:
            type: string (phred format)
            description: phred string (FASTQ format) for the consensus contig from which this nt sequence was inferred
        repository_name:
            type: string
            description: Name of the repository in which the sequence has been deposited
            completed_by: submitter
        repository_id:
            type: string
            description: Id or serial number of the sequence within the repository
            completed_by: submitter        
        deposited_version:
            type: string
            description: Version number of the sequence within the repository
            completed_by: submitter
        IARC_tracking:
            type: list of timestamped strings
            description: Notes from IARC tracking overall progress of this submission, eg additional info requested, when reviewed, etc
            completed_by: IARC
       
# V-Gene Genotype, for each subject referenced in the set of inferred sequences
GenotypeDescription:
    discriminator: AIRR
    description: Summary details of the genotype
    type: object
    occurrence: multiple
    properties:
        genotype_name:
            type: string
            description: Descriptive name for this genotype
            completed_by: submitter
            tableview: true
            nonblank: true
        genotype_subject_id:
            type: string
            description: Identifier of the subject from which this genotype was inferred
            completed_by: submitter
            tableview: true
        genotype_filename:
            type: string
            description: Name of the uploaded file from which the genotype was read
            tableview: true
            readonly: true
        genotype_file:
            type: blob
            hide: true
            description: Contents of the uploaded file from which the genotype was read
        submission_id:
            type: integer
            hide: true
            foreign_key: submission.id
            relationship: [submission, Submission, genotype_descriptions]
        inference_tool_id:
            type: integer
            hide: true
            foreign_key: inference_tool.id
            relationship: [inference_tool, InferenceTool, genotype_descriptions]


Genotype:
    discriminator: AIRR
    description: Details of the complete genotype from which inferred sequences were drawn
    type: object
    occurrence: multiple
    properties:
        sequence_id:
            type: string
            description: Identifier of the allele (either IMGT, or the name assigned by the submitter to an inferred gene)
            completed_by: submitter
            tableview: true
        sequences:
            type: integer
            description: Overall number of sequences assigned to this allele
            completed_by: submitter
            tableview: true
        closest_reference:
            type: string
            description: For inferred alleles, the closest reference gene and allele, as inferred by the tool
            completed_by: submitter
            tableview: true
        closest_host:
            type: string
            description: For inferred alleles, the closest reference gene and allele that is in the subject's inferred genotype, as inferred by the tool
            completed_by: submitter
            tableview: true
        nt_diff:
            type: integer
            description: For inferred alleles, the number of nucleotides that differ between this sequence and the closest reference gene and allele
            completed_by: submitter
            tableview: true
        nt_substitutions:
            type: string
            description: List of nucleotide substitutions (e.g. G112A) between this sequence and the closest reference gene and allele
            completed_by: submitter            
            tableview: true
        aa_diff:
            type: integer
            description: For inferred alleles, the number of amino acids that differ between this sequence and the closest reference gene and allele
            completed_by: submitter
            tableview: true
        aa_substitutions:
            type: string
            description: List of amino acid substitutions (e.g. A96N) between this sequence and the closest reference gene and allele. Please use IMGT numbering for V-genes, and number from start of coding sequence for D- or J- genes.
            completed_by: submitter            
            tableview: true
        unmutated_frequency:
            type: number
            description: The proportion of unmutated sequences in the dataset represented by this sequence.
            completed_by: submitter
            tableview: true
        unmutated_sequences:
            type: integer
            description: The number of records in the sequence dataset exactly matching this unmutated sequence
            completed_by: submitter
            tableview: true
        unmutated_umis:
            type: integer
            description: The number of molecules (identified by Unique Molecular Identifiers) exactly matching this unmutated sequence (if UMIs were used)
            completed_by: submitter
            tableview: true
        allelic_percentage:
            type: number
            description: The percentage at which this allele was observed in the sequence dataset, compared to other alleles
            completed_by: submitter
            tableview: true
        unique_ds:
            type: integer
            description: Number of D allele calls (i.e., unique allelic sequences) found associated with an inferred V sequence
            completed_by: submitter
            tableview: true
        unique_js:
            type: integer
            description: Number of J allele calls (i.e., unique allelic sequences) found associated with an inferred V sequence
            completed_by: submitter
            tableview: true
        unique_cdr3s:
            type: integer
            description: Number of unique CDR3s found associated with an inferred V sequence
            completed_by: submitter
            tableview: true
        haplotyping_locus:
            type: string
            description: Locus (or loci) from which haplotyping was inferred (e.g. IGHJ6)
            completed_by: submitter
            tableview: true
        haplotyping_ratio:
            type: string
            description: Ratio (expressed as two percentages) with which the two inferred haplotypes were found (e.g. 60:40)
            completed_by: submitter
            tableview: true
        nt_sequence:
            type: IUPAC nucleotide notation
            description: The consensus sequence provided by the inference tool
            completed_by: submitter
        description_id:
            type: integer
            hide: true
            foreign_key: genotype_description.id
            relationship: [genotype_description, GenotypeDescription, genotypes]

            
Observed_Sequence:
    discriminator: AIRR
    description: Details of a directly observed or inferred sequence which contributes to the inference of a gene
    type: object
    occurrence: multiple
    properties:
        sequence_id:
            type: string
            description: IARC unique reference for this sequence observation
        sequence:
            type: IUPAC nucleotide notation
            description: Sequence of interest described in this record
        derivation: 
            type: [DNA, mRNA]
            description: Material from which the sequence was derived
        observation_type:
            type: string
            description: e.g. direct sequencing, inference from repertoire
        notes:
            type: text
            description: Notes added by IARC
        repository_name:
            type: string
            description: Name of the repository in which the sequence has been deposited
        repository_id:
            type: string
            description: Id or serial number of the sequence within the repository
        deposited_version:
            type: string
            description: Version number of the sequence within the repository
        seq_start:
            type: integer
            description: Start co-ordinate of the sequence of interest described in this record, within the sequence deposited
        seq_end:
            type: integer
            description: End co-ordinate of the sequence of interest described in this record, within the sequence deposited
        
Genomic_Sequence:
    discriminator: AIRR
    description: Details of a genomic sequence which contributes to the inference of a gene
    type: object
    occurrence: multiple
    properties:
        sequence_id:
            type: string
            description: IARC unique reference for this sequence observation
        sequence:
            type: nucleotide sequence
            description: Sequence of interest described in this record (typically this will include gene and propoter region)
        notes:
            type: text
            description: Notes added by IARC
        assembly_id:
            type: string
            description: Ensembl identifier of the genome in which this gene was inferred, including build ID (e.g. GRCh38)
        patch_no:
            type: string
            description: Genome assembly patch number in which this gene was inferred (e.g. p7)
        gff_seqid:
            type: string
            description: Germline sequence (from the genome) of a window including the gene and preferably also the promoter region
        gff_start:
            type: integer
            description: Genomic co-ordinates of the start of the sequence of interest described in this record, in Ensemble GFF version 3 
        gff_end:
            type: integer
            description: Genomic co-ordinates of the end of the sequence of interest described in this record, in Ensemble GFF version 3
        gff_strand:
            type: [+,-]
            description: 
    
Gene_Description:
    discriminator: AIRR
    version: 1.4
    description: Details of a gene sequence which is inferred from one or more observations
    type: object
    occurrence: multiple
    properties:
        description_id:
            type: string
            description: Unique identifier of this gene sequence
        author:
            type: name
            description: Corresponding author
        lab_name:
            type: string
            description: Department of corresponding author
        lab_address:
            type: string
            description: Institutional address of corresponding author
        release_version:
            type: number
            description: Version number of this record, updated whenever a revised version is published or released
        release_description:
            type: string
            description: Brief descriptive notes of the reason for this release and the changes embodied
        release_date:
            type: date
            description: Date of this release
        pub_ids:
            type: list of PubMed ids
            description: Peer-reviewed publications describing this inference
        organism:
            type: string
            description: Binomial designation of subject's species
        sequence_name:
            type: string
            description: The canonical name of this sequence (i.e., the name which the curators determine should be used by preference)
        alt_names:
            type: strings
            description: Alternative names for this sequence
        receptor_type:
            type: [B-cell, T-cell]
            description: Receptor type
        locus:
            type: [Heavy, Light-Kappa or Light-Lambda for B-cell sequences, or Alpha, Beta or Gamma for T-cell sequences]
            description: Gene locus
        domain:
            type: [V,D,J,C]
            description: Sequence domain (V, D, J or Constant)
        functional:
            type: Boolean
            description: Functional
        inference_type:
            type: [Genomic and Rearranged, Genomic Only, Rearranged Only]
            description: Type of inference(s) from which this gene sequence was inferred (Genomic and Rearranged, Genomic Only, Rearranged Only)
        affirmation_level:
            type: [1,2,3]
            description: Count of independent studies in which this allele as been affirmed by IARC (1,2,3 or more)
        status:
            type: [Active, Deprecated, Novel]
            description: Deprecated sequences are those that have been superceded or removed because of errors or uncertainty. Novel sequences are those that have not been fully scrutinised. Others are Active.
        deprecation_reason:
            type: string
            description: If deprecated, the reason for deprecation
        gene_subgroup:
            type: string
            description: Gene subgroup (family), as (and if) identified for this species and gene 
        subgroup_designation:
            type: string
            description: Gene designation within this subgroup
        allele_designation:
            type: string
            description: Allele designation
        sequence:
            type: IUPAC nucleotide notation
            description: nt sequence of the gene. This should cover the full length that is available, including where possible 5' UTR and lead-in for V-gene sequences 
        coding_seq_imgt:
            type: sequence
            description: nucleotide sequence of the coding region, aligned, in the case of a V-gene, with the IMGT numbering scheme
        codon_frame:
            type: [1,2,3]
            description: Codon position of the first sequence symbol in coding_seq_imgt. Mandatory for J genes. Not used for V or D genes. ('1' means the sequence is in-frame, '2' means that the first bp is missing from the first codon, '3' means that the first 2 bp are missing)
        j_cdr3_end:
            type: integer
            description: In the case of a J-gene, the co-ordinate (in coding_seq_imgt) of the first nucelotide of the conserved PHE or TRP (IMGT codon position 118)
        utr_5_prime_start:
            type: integer
            description: Start co-ordinate of 5 prime UTR
        utr_5_prime_end:
            type: integer
            description: End co-ordinate of 5 prime UTR
        l_region_start:
            type: integer
            description: Start co-ordinate of L region
        l_region_end:
            type: integer
            description: End co-ordinate of L region
        v_rs_start:
            type: integer
            description: Start co-ordinate of V recombination site (V-genes only)
        v_rs_end:
            type: integer
            description: End co-ordinate of V recombination site (V-genes only)
        d_rs_3_prime_start:
            type: integer
            description: Start co-ordinate of 3 prime D recombination site (D-genes only)
        d_rs_3_prime_end:
            type: integer
            description: End co-ordinate of 3 prime D recombination site (D-genes only)
        d_rs_5_prime_start:
            type: integer
            description: Start co-ordinate of 5 prime D recombination site (D-genes only)
        d_rs_5_prime_end:
            type: integer
            description: End co-ordinate of 5 prime D recombination site (D-genes only)
        j_rs_start:
            type: integer
            description: Start co-ordinate of J recombination site (J-genes only)
        j_rs_end:
            type: integer
            description: End co-ordinate of J recombination site (J-genes only)
        paralogs:
            type: list of strings
            description: Canonical names of 0 or more paralogs
        notes:
            type: string
            description: 
            
Gene_Delineation_V:
    discriminator: AIRR
    description: Delineation of a V-gene in a particular system
    type: object
    occurrence: multiple
    properties:
        gene_name:
            type: string
            description: Canonical name of the gene to which this delineation applies
        gene_release_version:
            type: integer
            description: Version of the Gene Description to which this delineation applies
        delineation_scheme:
            type: string
            description: e.g. Kabat, IMGT, Chothia
        v_start:
            type: integer
            description: Co-ordinate of first V nucleotide in Gene Description 'sequence' field
        v_end:
            type: integer
            description: End co-ordinate of the V segment in Gene Description 'sequence' field
        fwr1_start:
            type: integer
            description: FWR1 start co-ordinate in Gene Description 'sequence' field
        fwr1_end:
            type: integer
            description: FWR1 end co-ordinate in Gene Description 'sequence' field
        cdr1_start:
            type: integer
            description: CDR1 start co-ordinate in Gene Description 'sequence' field
        cdr1_end:
            type: integer
            description: CDR1 end co-ordinate in Gene Description 'sequence' field
        fwr2_start:
            type: integer
            description: FWR2 start co-ordinate in Gene Description 'sequence' field
        fwr2_end:
            type: integer
            description: FWR2 end co-ordinate in Gene Description 'sequence' field
        cdr2_start:
            type: integer
            description: CDR2 start co-ordinate in Gene Description 'sequence' field
        cdr2_end:
            type: integer
            description: CDR2 end co-ordinate in Gene Description 'sequence' field
        fwr3_start:
            type: integer
            description: FWR3 start co-ordinate in Gene Description 'sequence' field
        fwr3_end:
            type: integer
            description: FWR3 end co-ordinate in Gene Description 'sequence' field
        cdr3_start:
            type: integer
            description: CDR3 start co-ordinate in Gene Description 'sequence' field
        alignment:
            type: list of integers
            description: one number for each codon in the fields v_start to cdr3_start indicating the number of that codon according to the numbering of the delineation scheme
            

Gene_Delineation_D:
    discriminator: AIRR
    description: Delineation of a D-gene in a particular system
    type: object
    occurrence: multiple
    properties:
        gene_name:
            type: name
            description: Canonical name of the gene to which this delineation applies
        gene_release_version:
            type: integer
            description: Version of the Gene Description to which this delineation applies
        delineation_scheme:
            type: string
            description: e.g. Kabat, IMGT, Chothia
        d_start:
            type: integer
            description: Co-ordinate of first D nucleotide in Gene Description 'sequence' field
        d_end:
            type: integer
            description: End co-ordinate of the D segment in Gene Description 'sequence' field
             

Gene_Delineation_J:
    discriminator: AIRR
    description: Delineation of a J-gene in a particular system
    type: object
    occurrence: multiple
    properties:
        gene_name:
            type: name
            description: Canonical name of the gene to which this delineation applies
        gene_release_version:
            type: integer
            description: Version of the Gene Description to which this delineation applies
        delineation_scheme:
            type: string
            description: e.g. Kabat, IMGT, Chothia
        j_start:
            type: integer
            description: Co-ordinate of first D nucleotide in Gene Description 'sequence' field
        j_end:
            type: integer
            description: End co-ordinate of the D segment in Gene Description 'sequence' field
        cdr3_end:
            type: integer
            description: End co-ordinate of the CDR3 in Gene Description 'sequence' field
 
 
Germline_Set:
    discriminator: AIRR
    description: Details of a gene which is inferred from the observation of one or more sequences
    type: object
    occurrence: multiple
    properties:
        author:
            type: name
            description: Corresponding author
        lab_name:
            type: string
            description: Department of corresponding author
        lab_address:
            type: string
            description: Institutional address of corresponding author
        release_version:
            type: number
            description: Version number of this record, allocated automatically
        release_description:
            type: string
            description: Brief descriptive notes of the reason for this release and the changes embodied
        release_date:
            type: date
            description: Date of this release
        pub_ids:
            type: list of PubMed ids
            description: Peer-reviewed publications describing this dataset
        organism:
            type: string
            description: Binomial designation of subject's species
        gene_descriptions:
            type: string
            description: list of one or more Gene_Description records
        notes:
            type: string
            description: 
  

