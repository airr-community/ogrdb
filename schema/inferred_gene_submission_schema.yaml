#
# Schema definitions for IARC inferred gene submissions
#
# Submission Details
Submission:
    discriminator: AIR3
    description: Overall details of the submission
    type: object
    occurrence: single
    version: 1.4
    properties:
        submission_id:
            type: string
            description: Unique ID assigned by IARC on recipt of submission
            completed_by: IARC
            label: Submission ID
            readonly: true
            tableview: true
        submission_date:
            type: date
            description: Date submission received
            completed_by: IARC
            label: Submission Date
            readonly: true
            tableview: true
        submission_status:
            type: [draft,reviewing,published,complete]
            description: Status of submission
            completed_by: IARC
            label: Submission Status
            readonly: true
            tableview: true
        submitter_name:
            type: string
            description: Full contact information of the submitter, i.e. the person depositing the data
            completed_by: submitter
            label: Submitter
            tableview: true
            readonly: true
        submitter_address:
            type: string
            description: Institutional address of submitter
            completed_by: submitter
            label: Submitter Address
            readonly: true
        submitter_email:
            type: email_address
            description: Preferred email address of submitter
            completed_by: submitter
            label: Submitter Email
            readonly: true
            private: true
        species:
            description: Binomial designation of subject's species
            completed_by: submitter
            label: Species
            type: []
            tableview: true
        population_ethnicity:
            type: string
            description: Information on the ethnicity/population/race of the sample from which the submitted allele was inferred (if not known, use UN)
            completed_by: submitter
            label: Ethnicity
        owner_id:
            type: integer
            hide: true
            foreign_key: user.id
            relationship: [owner, User, submissions]

#Journal Entries
JournalEntry:
    discriminator: AIRR
    description: Message-style item used for history and notes
    type: object
    occurrence: single
    properties:
        date:
            type: date
            description: Date submission received
            tableview: true
            hide: true
        author:
            type: email_address
            description: email address of author
            tableview: true
            hide: true
        type:
            type: [history, note]
            description: Type of entry
            hide: true
        title:
            type: string
            description: title of entry
            label: Note title
            tableview: true
            nonblank: true
        body:
            type: text
            description: body text of entry
            label: Note
            rows: 15
            nonblank: true
        submission_id:
            type: integer
            foreign_key: submission.id
            relationship: [submission, Submission, journal_entries]
            hide: true
        parent_id:
            type: integer
            foreign_key: journal_entry.id
            self-relationship: [children, parent, id]
            hide: true




# Repertoire Dataset
Repertoire:
    discriminator: AIRR
    description: Details of the repertoire dataset from which inferences were made
    type: object
    occurrence: single
    properties:
        pub_ids:
            type: list of PubMed ids
            description: Comma-separated list of PubMed IDs of peer-reviewed publications describing this dataset
            completed_by: submitter
            label: PubMed IDs
            ignore: true
        repository_name:
            type: string
            description: Name of the repository holding the sequence dataset (e.g. NIH SRA, or ENA)
            completed_by: submitter
            label: Repository
            nonblank: true
        rep_accession_no:
            type: string
            description: Accession number or serial number within the repository (e.g. NIH Project or ENA Study)
            completed_by: submitter
            label: Accession Number
            nonblank: true
        dataset_url:
            type: url
            description: URL of the study or project within the repository
            completed_by: submitter
            label: Dataset URL
        miarr_compliant:
            type: [Yes, No]
            description: Yes if the repertoire dataset and associated metadata is available in MiAIRR format
            completed_by: submitter
            label: MiAIRR Compliant?
        miairr_link:
            type: url
            description: Link to MiAIRR metadata, if available
            completed_by: submitter
            label: MiAIRR URL
        sequencing_platform:
            type: string
            description: Designation of sequencing instrument used
            completed_by: submitter
            label: Sequencing Platform
            nonblank: true
        read_length:
            type: string
            description: Read length in bases for each direction
            completed_by: submitter
            label: Read Length
            nonblank: true
        forward_primer_set:
            type: list of IUPAC nucleotide notation
            description: sequences of forward pcr primers used for sequence amplification
            completed_by: submitter
            ignore: true
        reverse_primer_set:
            type: list of IUPAC nucleotide notation
            description: sequences of reverse pcr primers used for sequence amplification
            completed_by: submitter
            ignore: true
        primers_overlapping:
            type: [Yes, No]
            description: Do primers overlap with the stated sequence of any inferred allele?
            completed_by: submitter
            label: Primers Overlapping?
        submission_id:
            type: integer
            hide: true
            foreign_key: submission.id
            relationship: [submission, Submission, repertoire]


# PubMed Ids
PubId:
    discriminator: AIRR
    description: PubMed Id and publication details
    type: object
    occurrence: single
    properties:
        pubmed_id:
            type: string
            description: PubMed ID (e.g. 26543)
            tableview: true
            label: PubMed ID
        pub_title:
            type: string
            description: Publication Title
            tableview: true
            hide: true
            label: Title
        pub_authors:
            type: string
            description: Author list
            tableview: true
            hide: true
            label: Authors
        repertoire_id:
            type: integer
            foreign_key: repertoire.id
            relationship: [repertoire, Repertoire, pub_ids]
            hide: true

# Primers
ForwardPrimer:
    discriminator: AIRR
    description: Forward Primer Set
    type: object
    occurrence: single
    properties:
        fw_primer_name:
            type: string
            description: Primer name or quick description
            tableview: true
            label: Primer Name
        fw_primer_seq:
            type: ambiguous nucleotide sequence
            description: primer sequence (may contain ambiguous characters)
            tableview: true
            label: Primer Sequence
        repertoire_id:
            type: integer
            foreign_key: repertoire.id
            relationship: [repertoire, Repertoire, forward_primer_set]
            hide: true

ReversePrimer:
    discriminator: AIRR
    description: Reverse Primer Set
    type: object
    occurrence: single
    properties:
        rv_primer_name:
            type: string
            description: Primer name or quick description
            tableview: true
            label: Primer Name
        rv_primer_seq:
            type: ambiguous nucleotide sequence
            description: primer sequence (may contain ambiguous characters)
            tableview: true
            label: Primer Sequence
        repertoire_id:
            type: integer
            foreign_key: repertoire.id
            relationship: [repertoire, Repertoire, reverse_primer_set]
            hide: true

Acknowledgements:
    discriminator: AIRR
    description: List of individuals whose contribution to this work should be acknowledged
    type: object
    occurrence: multiple
    properties:
        ack_name:
            type: string
            description: Name of individual to be acknowledged as contributing to this work
            tableview: true
            label: Name
        ack_institution_name:
            type: string
            description: Individual's department and institution name
            tableview: true
            label: Institution
        ack_ORCID_id:
            type: ORCID ID
            description: Individual's ORCID Id, if available
            tableview: true
            label: ORCID ID
        submission_id:
            type: integer
            hide: true
            foreign_key: submission.id
            relationship: [submission, Submission, acknowledgements]


# Inference Tool
InferenceTool:
    discriminator: AIRR
    description: Tool used to infer the submitted sequences
    type: object
    occurrence: single
    properties:
        tool_settings_name:
            type: string
            description: Descriptive name for this combination of tool and settings
            completed_by: submitter
            tableview: true
            label: Tool/Settings Name
            nonblank: true
        tool_name:
            type: string
            description: Name of the inference tool
            completed_by: submitter
            tableview: true
            label: Tool Name
            nonblank: true
        tool_version:
            type: string
            description: Version of the inference tool
            completed_by: submitter
            tableview: true
            label: Tool Version
            nonblank: true
        tool_starting_database:
            type: text
            description: Starting germline database used by the tool (please specify where and when it was obtained, name, and version id, if any)
            completed_by: submitter
            rows: 10
            label: Starting Database
            nonblank: true
        tool_settings:
            type: text
            description: Settings/configuration of the tool when used to provide the inferences
            completed_by: submitter
            rows: 20
            label: Settings
            nonblank: true
        submission_id:
            type: integer
            hide: true
            foreign_key: submission.id
            relationship: [submission, Submission, inference_tools]

            
# Inferred Sequence
InferredSequence:
    discriminator: AIRR
    description: Details of inferred sequences submitted for IARC approval
    type: object
    occurrence: multiple
    properties:
        sequence_id:
            type: integer
            description: Identifier of the sequence within the genotype
            foreign_key: genotype.id
            relationship: [sequence_details, Genotype, inferred_sequences]
        submission_id:
            type: integer
            hide: true
            description: Identifier of the submission in which these sequences are listed
            foreign_key: submission.id
            relationship: [submission, Submission, inferred_sequences]
        genotype_id:
            type: integer
            description: Identifier of the genotype from which these sequences were inferred
            foreign_key: genotype_description.id
            relationship: [genotype_description, GenotypeDescription, inferred_sequences]
        seq_accession_no:
            type: string
            description: Accession number of the inferred allele within the repository
            completed_by: submitter
            label: Accession Number
            nonblank: true
        deposited_version:
            type: string
            description: Version number of the sequence within the repository
            completed_by: submitter
            label: Version
        run_ids:
            type: string
            description: Comma-separated list of accession number(s) of the run(s) listing the raw sequences from which this inference was made
            completed_by: submitter
            label: Run Accession Numbers
            nonblank: true


# V-Gene Genotype, for each subject referenced in the set of inferred sequences
GenotypeDescription:
    discriminator: AIRR
    description: Summary details of the genotype
    type: object
    occurrence: multiple
    properties:
        genotype_name:
            type: string
            description: Descriptive name for this genotype
            completed_by: submitter
            tableview: true
            nonblank: true
            label: Genotype Name
        genotype_subject_id:
            type: string
            description: Identifier of the subject from which this genotype was inferred
            completed_by: submitter
            tableview: true
            label: Subject ID
            nonblank: true
        genotype_biosample_ids:
            type: list
            description: Comma-separated list of accession number(s) of the sample(s) from which the genotype was derived (e.g. NIH biosamples or ENA samples)
            completed_by: submitter
            label: Sample IDs
            nonblank: true
        submission_id:
            type: integer
            hide: true
            foreign_key: submission.id
            relationship: [submission, Submission, genotype_descriptions]
        inference_tool_id:
            type: integer
            foreign_key: inference_tool.id
            relationship: [inference_tool, InferenceTool, genotype_descriptions]
            label: Inference Tool
        genotype_file:
            type: blob
            description: Contents of the uploaded file from which the genotype was read
            label: Genotype File
        genotype_filename:
            type: string
            description: Name of the uploaded file from which the genotype was read
            tableview: true
            readonly: true
            label: Genotype Filename


Genotype:
    discriminator: AIRR
    description: Details of the complete genotype from which inferred sequences were drawn
    type: object
    occurrence: multiple
    properties:
        sequence_id:
            type: string
            description: Identifier of the allele (either IMGT, or the name assigned by the submitter to an inferred gene)
            completed_by: submitter
            tableview: true
            label: Allele name
        sequences:
            type: integer
            description: Overall number of sequences assigned to this allele
            completed_by: submitter
            tableview: true
            label: Sequences
        closest_reference:
            type: string
            description: For inferred alleles, the closest reference gene and allele, as inferred by the tool
            completed_by: submitter
            tableview: true
            label: Closest Reference
        closest_host:
            type: string
            description: For inferred alleles, the closest reference gene and allele that is in the subject's inferred genotype, as inferred by the tool
            completed_by: submitter
            tableview: true
            label: Closest in Host
        nt_diff:
            type: integer
            description: For inferred alleles, the number of nucleotides that differ between this sequence and the closest reference gene and allele
            completed_by: submitter
            tableview: true
            label: NT Diffs
        nt_substitutions:
            type: string
            description: Comma-separated list of nucleotide substitutions (e.g. G112A) between this sequence and the closest reference gene and allele
            completed_by: submitter            
            tableview: true
            label: NT Substs
        aa_diff:
            type: integer
            description: For inferred alleles, the number of amino acids that differ between this sequence and the closest reference gene and allele
            completed_by: submitter
            tableview: true
            label: AA Diffs
        aa_substitutions:
            type: string
            description: List of amino acid substitutions (e.g. A96N) between this sequence and the closest reference gene and allele. Please use IMGT numbering for V-genes, and number from start of coding sequence for D- or J- genes.
            completed_by: submitter            
            tableview: true
            label: AA Substs
        unmutated_frequency:
            type: number
            description: The number of sequences exactly matching the sequence of this allele divided by the number of sequences exactly matching any allele of any gene, *100
            completed_by: submitter
            tableview: true
            label: Unmutated Freq
        unmutated_sequences:
            type: integer
            description: he number of sequences exactly matching this unmutated sequence
            completed_by: submitter
            tableview: true
            label: Unmutated Seqs
        unmutated_umis:
            type: integer
            description: The number of molecules (identified by Unique Molecular Identifiers) exactly matching this unmutated sequence (if UMIs were used)
            completed_by: submitter
            tableview: true
            label: Unmutated UMIs
        allelic_percentage:
            type: number
            description: The number of sequences exactly matching the sequence of this allele divided by the number of sequences exactly matching any allele of this specific gene, *100
            completed_by: submitter
            tableview: true
            label: Allelic %
        unique_ds:
            type: integer
            description: Number of D allele calls (i.e., unique allelic sequences) found associated with an inferred V sequence
            completed_by: submitter
            tableview: true
            label: Unique Ds
        unique_js:
            type: integer
            description: Number of J allele calls (i.e., unique allelic sequences) found associated with an inferred V sequence
            completed_by: submitter
            tableview: true
            label: Unique Js
        unique_cdr3s:
            type: integer
            description: Number of unique CDR3s found associated with an inferred V sequence
            completed_by: submitter
            tableview: true
            label: Unique CDR3s
        haplotyping_locus:
            type: string
            description: Locus (or loci) from which haplotyping was inferred (e.g. IGHJ6)
            completed_by: submitter
            tableview: true
            label: Haplotyping Locus
        haplotyping_ratio:
            type: string
            description: Ratio (expressed as two percentages) with which the two inferred haplotypes were found (e.g. 60:40)
            completed_by: submitter
            tableview: true
            label: Haplotyping Ratio
        nt_sequence:
            type: IUPAC nucleotide notation
            description: The consensus sequence provided by the inference tool
            completed_by: submitter
            label: NT Sequence
        description_id:
            type: integer
            hide: true
            foreign_key: genotype_description.id
            relationship: [genotype_description, GenotypeDescription, genotypes]

