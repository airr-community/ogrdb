<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    {% block head %}
    <title>{% block title %}OGRDB{% endblock %}</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/ogrdb-design-system.css') }}">
    <style>
    /* OGRDB Design System - CSS Custom Properties */
    :root {
        /* Primary Brand Colors */
        --ogrdb-primary: #3279A6;
        --ogrdb-primary-dark: #3242bb;
        --ogrdb-primary-light: #3887A6;
        --ogrdb-primary-lighter: #55C1D9;
        --ogrdb-primary-lightest: #6BE5F2;
        
        /* Extended Color Palette */
        --ogrdb-secondary: #6c757d;
        --ogrdb-success: #28a745;
        --ogrdb-success-light: #d4edda;
        --ogrdb-info: #17a2b8;
        --ogrdb-info-light: #d1ecf1;
        --ogrdb-warning: #5f3c11;
        --ogrdb-warning-light: #fff3cd;
        --ogrdb-danger: #991414;
        --ogrdb-danger-light: #f8d7da;
        
        /* Semantic Colors */
        --ogrdb-text-primary: #212529;
        --ogrdb-text-secondary: #6c757d;
        --ogrdb-text-muted: #868e96;
        --ogrdb-link: var(--ogrdb-primary);
        --ogrdb-link-hover: var(--ogrdb-primary-dark);
        
        /* Background Colors */
        --ogrdb-bg-body: #dae6f3;
        --ogrdb-bg-outer: #09197D;
        --ogrdb-bg-card: #e8e9e4;
        --ogrdb-bg-light: #b4c7db;
        --ogrdb-bg-lighter: #f1f3f4;
        --ogrdb-bg-dark: #343a40;
        
        /* Border Colors */
        --ogrdb-border-color: #dee2e6;
        --ogrdb-border-light: #e9ecef;
        --ogrdb-border-dark: #adb5bd;
        
        /* Shadows */
        --ogrdb-shadow-sm: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        --ogrdb-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
        --ogrdb-shadow-lg: 0 1rem 3rem rgba(0, 0, 0, 0.175);
        --ogrdb-shadow-primary: 0 0.5rem 1rem rgba(24, 141, 251, 0.25);
        
        /* Spacing Scale */
        --ogrdb-spacer-xs: 0.25rem;
        --ogrdb-spacer-sm: 0.5rem;
        --ogrdb-spacer: 1rem;
        --ogrdb-spacer-lg: 1.5rem;
        --ogrdb-spacer-xl: 3rem;
        
        /* Border Radius */
        --ogrdb-border-radius: 0.375rem;
        --ogrdb-border-radius-sm: 0.25rem;
        --ogrdb-border-radius-lg: 0.5rem;
        --ogrdb-border-radius-xl: 1rem;
        
        /* Typography Scale */
        --ogrdb-font-size-xs: 0.75rem;
        --ogrdb-font-size-sm: 0.875rem;
        --ogrdb-font-size-base: 1rem;
        --ogrdb-font-size-lg: 1.125rem;
        --ogrdb-font-size-xl: 1.25rem;
        --ogrdb-font-size-xxl: 1.5rem;
        
        /* Font Weights */
        --ogrdb-font-weight-light: 300;
        --ogrdb-font-weight-normal: 400;
        --ogrdb-font-weight-medium: 500;
        --ogrdb-font-weight-semibold: 600;
        --ogrdb-font-weight-bold: 700;
        
        /* Line Heights */
        --ogrdb-line-height-sm: 1.25;
        --ogrdb-line-height-base: 1.5;
        --ogrdb-line-height-lg: 1.75;
        
        /* Transitions */
        --ogrdb-transition-base: all 0.2s ease-in-out;
        --ogrdb-transition-fast: all 0.15s ease-in-out;
        --ogrdb-transition-slow: all 0.3s ease-in-out;
    }
    
    /* Enhanced Typography Scale */
    .text-xs { font-size: var(--ogrdb-font-size-xs) !important; }
    .text-sm { font-size: var(--ogrdb-font-size-sm) !important; }
    .text-lg { font-size: var(--ogrdb-font-size-lg) !important; }
    .text-xl { font-size: var(--ogrdb-font-size-xl) !important; }
    .text-xxl { font-size: var(--ogrdb-font-size-xxl) !important; }
    
    .fw-medium { font-weight: var(--ogrdb-font-weight-medium) !important; }
    .fw-semibold { font-weight: var(--ogrdb-font-weight-semibold) !important; }
    
    .lh-sm { line-height: var(--ogrdb-line-height-sm) !important; }
    .lh-lg { line-height: var(--ogrdb-line-height-lg) !important; }
    
    /* Content Spacing Rules */
    h1, h2, h3, h4, h5, h6 {
        margin-bottom: var(--ogrdb-spacer-sm);
    }
    
    h1 + *, h2 + *, h3 + *, h4 + *, h5 + *, h6 + * {
        margin-top: var(--ogrdb-spacer-sm);
    }
    
    p {
        margin-bottom: var(--ogrdb-spacer-sm);
    }
    
    p:last-child {
        margin-bottom: 0;
    }
    
    /* Section Header Spacing */
    .card-body h6 {
        margin-top: var(--ogrdb-spacer-lg);
        margin-bottom: var(--ogrdb-spacer-sm);
    }
    
    .card-body h6:first-child {
        margin-top: 0;
    }
    
    /* Data Card Integration with Bootstrap Cards */
    .data-card .card-header {
        margin-bottom: var(--ogrdb-spacer);
        padding-bottom: var(--ogrdb-spacer);
        border-bottom: 1px solid var(--ogrdb-border-light);
    }
    
    .data-card .card-body {
        padding-top: 0;
    }
    
    /* Ensure proper spacing between card header and table */
    .data-card .card-header + .card-body .table-responsive:first-child {
        margin-top: var(--ogrdb-spacer);
    }
    
    /* Enhanced Brand Color Utilities */
    .text-primary { color: var(--ogrdb-primary) !important; }
    .text-primary-dark { color: var(--ogrdb-primary-dark) !important; }
    .text-primary-light { color: var(--ogrdb-primary-light) !important; }
    .text-muted { color: var(--ogrdb-text-muted) !important; }
    
    .bg-primary { background-color: var(--ogrdb-primary) !important; }
    .bg-primary-light { background-color: var(--ogrdb-primary-light) !important; }
    .bg-primary-lighter { background-color: var(--ogrdb-primary-lighter) !important; }
    .bg-primary-lightest { background-color: var(--ogrdb-primary-lightest) !important; }
    
    .border-primary { border-color: var(--ogrdb-primary) !important; }
    .border-light { border-color: var(--ogrdb-border-light) !important; }
    
    /* Enhanced Shadow Utilities */
    .shadow-primary { box-shadow: var(--ogrdb-shadow-primary) !important; }
    .shadow-hover { transition: var(--ogrdb-transition-base); }
    .shadow-hover:hover { box-shadow: var(--ogrdb-shadow-lg) !important; transform: translateY(-2px); }
    
    /* Card Enhancements */
    .card {
        background-color: var(--ogrdb-bg-card);
        border: 1px solid var(--ogrdb-border-light);
        box-shadow: var(--ogrdb-shadow-sm);
        transition: var(--ogrdb-transition-base);
    }
    
    .card-hover:hover {
        box-shadow: var(--ogrdb-shadow);
        transform: translateY(-2px);
    }
    
    .card-primary {
        border-left: 4px solid var(--ogrdb-primary);
    }
    
    .card-success {
        border-left: 4px solid var(--ogrdb-success);
    }
    
    .card-warning {
        border-left: 4px solid var(--ogrdb-warning);
    }
    
    .card-info {
        border-left: 4px solid var(--ogrdb-info);
    }
    
    /* Button Enhancements */
    .btn {
        transition: var(--ogrdb-transition-base);
        font-weight: var(--ogrdb-font-weight-medium);
        border-radius: var(--ogrdb-border-radius);
    }
    
    .btn-primary {
        background-color: var(--ogrdb-primary);
        border-color: var(--ogrdb-primary);
    }
    
    .btn-primary:hover,
    .btn-primary:focus {
        background-color: var(--ogrdb-primary-dark);
        border-color: var(--ogrdb-primary-dark);
        box-shadow: var(--ogrdb-shadow-primary);
    }
    
    .btn-outline-primary {
        color: var(--ogrdb-primary);
        border-color: var(--ogrdb-primary);
    }
    
    .btn-outline-primary:hover,
    .btn-outline-primary:focus {
        background-color: var(--ogrdb-primary);
        border-color: var(--ogrdb-primary);
    }
    
    /* Table Enhancements */
    .table {
        border-color: var(--ogrdb-border-light);
    }
    
    .table th {
        border-color: var(--ogrdb-border-color);
        background-color: var(--ogrdb-bg-light);
        font-weight: var(--ogrdb-font-weight-semibold);
        color: var(--ogrdb-text-primary);
    }
    
    .table td, .table th {
        vertical-align: middle;
        word-wrap: break-word;
        overflow-wrap: break-word;
    }
    
    /* Table cell content containment - allow content to wrap */
    .table td {
        overflow-wrap: break-word;
        word-wrap: break-word;
        vertical-align: top;
        min-width: 120px; /* Ensure minimum width for readability */
    }
    
    /* DOI column specific styling - wider to accommodate badges */
    .table td:has(a[href*="doi"]) {
        min-width: 180px;
        width: auto;
    }
    
    /* DOI badge specific styling - smaller and more compact */
    .table td .badge[href*="doi"],
    .table td a[href*="doi"] .badge {
        font-size: 0.65rem;
        padding: 0.15rem 0.4rem;
        max-width: 100%;
        word-break: break-all;
        white-space: normal;
        line-height: 1.1;
        display: inline-block;
    }
    
    /* Allow badges and buttons to wrap within cells */
    .table td .badge,
    .table td .btn {
        display: inline-block;
        margin: 0.1rem;
        word-break: break-word;
        white-space: normal;
        line-height: 1.2;
    }
    
    .table-hover tbody tr:hover {
        background-color: var(--ogrdb-primary-lightest);
    }
    
    /* Form Enhancements */
    .form-control,
    .form-select {
        border-color: var(--ogrdb-border-light);
        transition: var(--ogrdb-transition-base);
    }
    
    .form-control:focus,
    .form-select:focus {
        border-color: var(--ogrdb-primary);
        box-shadow: 0 0 0 0.2rem rgba(24, 141, 251, 0.25);
    }
    
    /* Alert Enhancements */
    .alert {
        border-radius: var(--ogrdb-border-radius);
        border: none;
    }
    
    .alert-primary {
        background-color: var(--ogrdb-primary-lightest);
        color: var(--ogrdb-primary-dark);
    }
    
    .alert-success {
        background-color: var(--ogrdb-success-light);
    }
    
    .alert-info {
        background-color: var(--ogrdb-info-light);
    }
    
    .alert-warning {
        background-color: var(--ogrdb-warning-light);
    }
    
    .alert-danger {
        background-color: var(--ogrdb-danger-light);
    }
    
    /* Navigation Enhancements */
    .navbar-brand {
        font-weight: var(--ogrdb-font-weight-bold);
        color: var(--ogrdb-primary) !important;
    }
    
    .nav-link {
        transition: var(--ogrdb-transition-base);
        font-weight: var(--ogrdb-font-weight-medium);
    }
    
    .nav-link:hover {
        color: var(--ogrdb-primary) !important;
    }
    
    /* Badge Enhancements */
    .badge {
        font-weight: var(--ogrdb-font-weight-medium);
    }
    
    .badge-primary {
        background-color: var(--ogrdb-primary);
    }
    
    /* Layout Utilities */
    .bg-gradient-primary {
        background: linear-gradient(135deg, var(--ogrdb-primary) 0%, var(--ogrdb-primary-dark) 100%);
    }
    
    .bg-pattern {
        background-color: var(--ogrdb-bg-light);
        background-image: radial-gradient(circle at 1px 1px, var(--ogrdb-border-light) 1px, transparent 0);
        background-size: 20px 20px;
    }
    
    /* Responsive Text Utilities */
    @media (max-width: 576px) {
        .text-responsive-sm { font-size: var(--ogrdb-font-size-sm) !important; }
        .display-responsive { font-size: 2rem !important; }
    }
    
    @media (min-width: 768px) {
        .text-responsive-md { font-size: var(--ogrdb-font-size-lg) !important; }
    }
    
    @media (min-width: 992px) {
        .text-responsive-lg { font-size: var(--ogrdb-font-size-xl) !important; }
    }
    
    /* Focus Management */
    .btn:focus,
    .form-control:focus,
    .form-select:focus {
        outline: 2px solid var(--ogrdb-primary);
        outline-offset: 2px;
    }
    
    /* Bootstrap 5 compatibility for BootstrapDialog type styling */
    .modal.type-danger .modal-header {
        background-color: var(--ogrdb-danger);
        color: white;
    }
    .modal.type-warning .modal-header {
        background-color: var(--ogrdb-warning);
        color: var(--ogrdb-text-primary);
    }
    .modal.type-primary .modal-header {
        background-color: var(--ogrdb-primary);
        color: white;
    }
    
    /* Enhanced Modal Styling */
    .modal-content {
        border-radius: var(--ogrdb-border-radius-lg);
        box-shadow: var(--ogrdb-shadow-lg);
        border: none;
    }
    
    .modal-header {
        background-color: var(--ogrdb-primary);
        color: white;
        border-radius: var(--ogrdb-border-radius-lg) var(--ogrdb-border-radius-lg) 0 0;
        border-bottom: none;
    }
    
    .modal-title {
        font-weight: var(--ogrdb-font-weight-semibold);
    }
    
    .modal-body {
        padding: var(--ogrdb-spacer-lg);
    }
    
    .modal-footer {
        border-top: 1px solid var(--ogrdb-border-light);
        background-color: var(--ogrdb-bg-light);
        border-radius: 0 0 var(--ogrdb-border-radius-lg) var(--ogrdb-border-radius-lg);
    }
    </style>
    {% endblock %}
</head>
<body>
    {% block body %}
    <div class="container-fluid">
        {% block content %}{% endblock %}
    </div>

    <!-- Global confirmation modal -->
    <div class="modal fade" id="confirmModal" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmModalLabel">Confirm Action</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="confirmModalBody">
                    Are you sure?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="confirmModalOK">OK</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Global dialog modal for BootstrapDialog.show compatibility -->
    <div class="modal fade" id="dialogModal" tabindex="-1" aria-labelledby="dialogModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="dialogModalLabel">Dialog</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="dialogModalBody">
                    <!-- Dynamic content will be inserted here -->
                </div>
                <div class="modal-footer" id="dialogModalFooter">
                    <!-- Dynamic buttons will be inserted here -->
                </div>
            </div>
        </div>
    </div>
    {% endblock %}
    {% block scripts %}
    <script>
    // Bootstrap 5 replacement for BootstrapDialog.confirm
    function showConfirmDialog(options) {
        const modal = document.getElementById('confirmModal');
        const modalBody = document.getElementById('confirmModalBody');
        const modalOK = document.getElementById('confirmModalOK');
        const modalTitle = document.getElementById('confirmModalLabel');
        
        // Remove previous type classes
        modal.classList.remove('type-danger', 'type-warning', 'type-primary');
        
        // Set content
        modalBody.innerHTML = options.message || 'Are you sure?';
        modalTitle.textContent = options.title || 'Confirm Action';
        
        // Set modal type class
        if (options.type) {
            modal.classList.add('type-' + options.type);
        }
        
        // Set button class based on type
        let btnClass = 'btn-primary';
        if (options.type === 'danger') btnClass = 'btn-danger';
        else if (options.type === 'warning') btnClass = 'btn-warning';
        else if (options.btnOKClass) btnClass = options.btnOKClass;
        
        modalOK.className = 'btn ' + btnClass;
        modalOK.textContent = options.btnOKLabel || 'OK';
        
        // Remove previous event listeners
        const newModalOK = modalOK.cloneNode(true);
        modalOK.parentNode.replaceChild(newModalOK, modalOK);
        
        // Add new event listener
        newModalOK.addEventListener('click', function() {
            if (options.callback && typeof options.callback === 'function') {
                options.callback(true);
            }
            bootstrap.Modal.getInstance(modal).hide();
        });
        
        // Show modal
        const bootstrapModal = new bootstrap.Modal(modal);
        bootstrapModal.show();
    }

    // Bootstrap 5 replacement for BootstrapDialog.show
    function showDialog(options) {
        const modal = document.getElementById('dialogModal');
        const modalBody = document.getElementById('dialogModalBody');
        const modalFooter = document.getElementById('dialogModalFooter');
        const modalTitle = document.getElementById('dialogModalLabel');
        
        // Remove previous type classes
        modal.classList.remove('type-danger', 'type-warning', 'type-primary');
        
        // Set modal type class
        if (options.type) {
            modal.classList.add('type-' + options.type);
        }
        
        // Set title
        modalTitle.textContent = options.title || 'Dialog';
        
        // Set content
        if (typeof options.message === 'function') {
            // Create a dialog object with methods for compatibility
            const dialogObject = {
                getButton: function(id) {
                    return {
                        enable: function() {
                            const btn = document.getElementById(id);
                            if (btn) btn.disabled = false;
                        },
                        disable: function() {
                            const btn = document.getElementById(id);
                            if (btn) btn.disabled = true;
                        }
                    };
                },
                close: function() {
                    bootstrap.Modal.getInstance(modal).hide();
                }
            };
            
            const content = options.message(dialogObject);
            if (content instanceof jQuery) {
                modalBody.innerHTML = content.html();
            } else if (content instanceof HTMLElement) {
                modalBody.innerHTML = '';
                modalBody.appendChild(content);
            } else {
                modalBody.innerHTML = content;
            }
        } else {
            modalBody.innerHTML = options.message || '';
        }
        
        // Clear and set buttons
        modalFooter.innerHTML = '';
        if (options.buttons && Array.isArray(options.buttons)) {
            options.buttons.forEach(function(btn) {
                const button = document.createElement('button');
                button.type = 'button';
                button.className = 'btn ' + (btn.cssClass || 'btn-secondary');
                button.textContent = btn.label || 'Button';
                if (btn.id) button.id = btn.id;
                if (btn.title) button.title = btn.title;
                
                button.addEventListener('click', function() {
                    if (btn.action && typeof btn.action === 'function') {
                        const dialogObject = {
                            close: function() {
                                bootstrap.Modal.getInstance(modal).hide();
                            }
                        };
                        btn.action(dialogObject);
                    }
                });
                
                modalFooter.appendChild(button);
            });
        } else {
            // Default close button
            const closeBtn = document.createElement('button');
            closeBtn.type = 'button';
            closeBtn.className = 'btn btn-secondary';
            closeBtn.textContent = 'Close';
            closeBtn.setAttribute('data-bs-dismiss', 'modal');
            modalFooter.appendChild(closeBtn);
        }
        
        // Show modal
        const bootstrapModal = new bootstrap.Modal(modal);
        bootstrapModal.show();
        
        // Call onshow if provided
        if (options.onshow && typeof options.onshow === 'function') {
            const dialogObject = {
                getButton: function(id) {
                    return {
                        enable: function() {
                            const btn = document.getElementById(id);
                            if (btn) btn.disabled = false;
                        },
                        disable: function() {
                            const btn = document.getElementById(id);
                            if (btn) btn.disabled = true;
                        }
                    };
                },
                close: function() {
                    bootstrap.Modal.getInstance(modal).hide();
                }
            };
            options.onshow(dialogObject);
        }
    }
    
    // Backward compatibility for BootstrapDialog
    window.BootstrapDialog = {
        TYPE_DANGER: 'danger',
        TYPE_WARNING: 'warning',
        TYPE_PRIMARY: 'primary',
        confirm: function(options) {
            showConfirmDialog({
                message: options.message,
                title: options.title,
                type: options.type,
                btnOKClass: options.btnOKClass,
                btnOKLabel: options.btnOKLabel,
                callback: options.callback
            });
        },
        show: function(options) {
            showDialog(options);
        }
    };
    </script>
    {% endblock %}
</body>
</html>
