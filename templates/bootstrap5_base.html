<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    {% block head %}
    <title>{% block title %}OGRDB{% endblock %}</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
    /* Bootstrap 5 compatibility for BootstrapDialog type styling */
    .modal.type-danger .modal-header {
        background-color: #dc3545;
        color: white;
    }
    .modal.type-warning .modal-header {
        background-color: #ffc107;
        color: #212529;
    }
    .modal.type-primary .modal-header {
        background-color: #0d6efd;
        color: white;
    }
    </style>
    {% endblock %}
</head>
<body>
    {% block body %}
    <div class="container-fluid">
        {% block content %}{% endblock %}
    </div>

    <!-- Global confirmation modal -->
    <div class="modal fade" id="confirmModal" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmModalLabel">Confirm Action</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="confirmModalBody">
                    Are you sure?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="confirmModalOK">OK</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Global dialog modal for BootstrapDialog.show compatibility -->
    <div class="modal fade" id="dialogModal" tabindex="-1" aria-labelledby="dialogModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="dialogModalLabel">Dialog</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="dialogModalBody">
                    <!-- Dynamic content will be inserted here -->
                </div>
                <div class="modal-footer" id="dialogModalFooter">
                    <!-- Dynamic buttons will be inserted here -->
                </div>
            </div>
        </div>
    </div>
    {% endblock %}
    {% block scripts %}
    <script>
    // Bootstrap 5 replacement for BootstrapDialog.confirm
    function showConfirmDialog(options) {
        const modal = document.getElementById('confirmModal');
        const modalBody = document.getElementById('confirmModalBody');
        const modalOK = document.getElementById('confirmModalOK');
        const modalTitle = document.getElementById('confirmModalLabel');
        
        // Remove previous type classes
        modal.classList.remove('type-danger', 'type-warning', 'type-primary');
        
        // Set content
        modalBody.innerHTML = options.message || 'Are you sure?';
        modalTitle.textContent = options.title || 'Confirm Action';
        
        // Set modal type class
        if (options.type) {
            modal.classList.add('type-' + options.type);
        }
        
        // Set button class based on type
        let btnClass = 'btn-primary';
        if (options.type === 'danger') btnClass = 'btn-danger';
        else if (options.type === 'warning') btnClass = 'btn-warning';
        else if (options.btnOKClass) btnClass = options.btnOKClass;
        
        modalOK.className = 'btn ' + btnClass;
        modalOK.textContent = options.btnOKLabel || 'OK';
        
        // Remove previous event listeners
        const newModalOK = modalOK.cloneNode(true);
        modalOK.parentNode.replaceChild(newModalOK, modalOK);
        
        // Add new event listener
        newModalOK.addEventListener('click', function() {
            if (options.callback && typeof options.callback === 'function') {
                options.callback(true);
            }
            bootstrap.Modal.getInstance(modal).hide();
        });
        
        // Show modal
        const bootstrapModal = new bootstrap.Modal(modal);
        bootstrapModal.show();
    }

    // Bootstrap 5 replacement for BootstrapDialog.show
    function showDialog(options) {
        const modal = document.getElementById('dialogModal');
        const modalBody = document.getElementById('dialogModalBody');
        const modalFooter = document.getElementById('dialogModalFooter');
        const modalTitle = document.getElementById('dialogModalLabel');
        
        // Remove previous type classes
        modal.classList.remove('type-danger', 'type-warning', 'type-primary');
        
        // Set modal type class
        if (options.type) {
            modal.classList.add('type-' + options.type);
        }
        
        // Set title
        modalTitle.textContent = options.title || 'Dialog';
        
        // Set content
        if (typeof options.message === 'function') {
            // Create a dialog object with methods for compatibility
            const dialogObject = {
                getButton: function(id) {
                    return {
                        enable: function() {
                            const btn = document.getElementById(id);
                            if (btn) btn.disabled = false;
                        },
                        disable: function() {
                            const btn = document.getElementById(id);
                            if (btn) btn.disabled = true;
                        }
                    };
                },
                close: function() {
                    bootstrap.Modal.getInstance(modal).hide();
                }
            };
            
            const content = options.message(dialogObject);
            if (content instanceof jQuery) {
                modalBody.innerHTML = content.html();
            } else if (content instanceof HTMLElement) {
                modalBody.innerHTML = '';
                modalBody.appendChild(content);
            } else {
                modalBody.innerHTML = content;
            }
        } else {
            modalBody.innerHTML = options.message || '';
        }
        
        // Clear and set buttons
        modalFooter.innerHTML = '';
        if (options.buttons && Array.isArray(options.buttons)) {
            options.buttons.forEach(function(btn) {
                const button = document.createElement('button');
                button.type = 'button';
                button.className = 'btn ' + (btn.cssClass || 'btn-secondary');
                button.textContent = btn.label || 'Button';
                if (btn.id) button.id = btn.id;
                if (btn.title) button.title = btn.title;
                
                button.addEventListener('click', function() {
                    if (btn.action && typeof btn.action === 'function') {
                        const dialogObject = {
                            close: function() {
                                bootstrap.Modal.getInstance(modal).hide();
                            }
                        };
                        btn.action(dialogObject);
                    }
                });
                
                modalFooter.appendChild(button);
            });
        } else {
            // Default close button
            const closeBtn = document.createElement('button');
            closeBtn.type = 'button';
            closeBtn.className = 'btn btn-secondary';
            closeBtn.textContent = 'Close';
            closeBtn.setAttribute('data-bs-dismiss', 'modal');
            modalFooter.appendChild(closeBtn);
        }
        
        // Show modal
        const bootstrapModal = new bootstrap.Modal(modal);
        bootstrapModal.show();
        
        // Call onshow if provided
        if (options.onshow && typeof options.onshow === 'function') {
            const dialogObject = {
                getButton: function(id) {
                    return {
                        enable: function() {
                            const btn = document.getElementById(id);
                            if (btn) btn.disabled = false;
                        },
                        disable: function() {
                            const btn = document.getElementById(id);
                            if (btn) btn.disabled = true;
                        }
                    };
                },
                close: function() {
                    bootstrap.Modal.getInstance(modal).hide();
                }
            };
            options.onshow(dialogObject);
        }
    }
    
    // Backward compatibility for BootstrapDialog
    window.BootstrapDialog = {
        TYPE_DANGER: 'danger',
        TYPE_WARNING: 'warning',
        TYPE_PRIMARY: 'primary',
        confirm: function(options) {
            showConfirmDialog({
                message: options.message,
                title: options.title,
                type: options.type,
                btnOKClass: options.btnOKClass,
                btnOKLabel: options.btnOKLabel,
                callback: options.callback
            });
        },
        show: function(options) {
            showDialog(options);
        }
    };
    </script>
    {% endblock %}
</body>
</html>
